<%- include("../../layouts/manager/head.ejs") -%>
<!-- support-section start -->
<div class="col-xl-12 col-md-12">

    <div class="card">
        <form method="POST" action="/manager/insertions/create_post">
            <div class="card-header">
                <h5>Ajouter une insertion</h5>
            </div>
            <div class="card-body">

                <div class="alert alert-primary">
                    <div class="media align-items-center">
                        <i class="feather icon-alert-circle h2"></i>
                        <div class="media-body ml-3">
                            Créer une insertion sur SMARTADSERVER en toute simplicité.
                        </div>
                    </div>
                </div>
                <% if (message) { %>

                <% if (message.type==="success") { %>

                <div class="alert alert-<%=message.type%>" role="alert">
                    <%=message.intro%>:<a href="<%=message.message%>"><strong> Voir la campagne</strong> </a>
                </div>

                <% }else{ %>

                <div class="alert alert-<%=message.type%>" role="alert">
                    <%=message.intro%>:<%=message.message%> </div>


                <%  } %>


                <%  } %>



                <fieldset>
                    <legend>ANNONCEUR</legend>

                    <div class="form-group">
                        <label class="form-label required" for="advertiser_id">Annonceur
                        </label>
                        <select class="form-control" id="advertiser_id" name="advertiser_id" required="required">

                            <option value="" selected disabled>Choisir une annonceur</option>

                            <% for (let i=0; i < advertisers.length; i++) { %>
                            <option value="<%= advertisers[i].advertiser_id %>"><%= advertisers[i].advertiser_name %>
                            </option>
                            <% } %>
                        </select>
                    </div>

                    <legend>CAMPAGNE</legend>

                    <div class="form-group">
                        <label class="form-label required" for="campaign_id">Campagne
                        </label>
                        <select class="form-control" id="campaign_id" name="campaign_id" required="required">

                            <option value="" selected disabled>Sélectionner une campagne</option>

                        </select>
                    </div>

                    <div class="row" style="display: none;">
                        <div class="form-group col-6">
                            <label class="form-label required" for="date_start">Date de début de campagne
                            </label>
                            <input type="date" name="date_start" id="date_start" class="form-control"
                                required="required" />
                        </div>

                        <div class="form-group col-6">
                            <label class="form-label required" for="date_end">Date de fin de campagne
                            </label>
                            <input type="date" name="date_end" id="date_end" class="form-control" required="required" />
                        </div>
                    </div>


                    <div class="row">
                        <div class="form-group col-6 ">
                            <label class="form-label required" for="format_group_id">Format
                            </label>
                            <select class="form-control" id="format_group_id" name="format_group_id"
                                required="required">
                                <option value="" selected disabled>Sélectionner le format</option>
                                <% for(let i=1; i < group_formats.length; i++) {%>
                                <option value="<%= group_formats[i].format_group_id %>">
                                    <%= group_formats[i].format_group_name %></option>
                                <% } %>
                            </select>
                        </div>

                        <div class="form-group col-6">
                            <label class="form-label required" for="creative_type_id">Type de créative
                            </label>
                            <select class="form-control" id="creative_type_id" name="creative_type_id"
                                required="required">
                                <option value="" selected disabled>Sélectionner un type créative</option>
                            </select>
                        </div>
                    </div>
                </fieldset>

                <legend>INSERTION CREATIVE</legend>
                <div class="form-group col-6">
                    <label class="form-label" for="insertion_name">Nom de l'insertion</label>
                    <input type="text" name="insertion_name" id="insertion_name" class="form-control"
                        placeholder="Saisissez un nom insertion" />
                </div>
                <fieldset id="creativeImage">
                    <legend>DISPLAY</legend>

                    <div class="row">
                        <div class="form-group col-6">
                            <label class="form-label required" for="display_desktop_file">Fichier Desktop</label>
                            <input type="url" name="display_desktop_file" id="display_desktop_file" class="form-control"
                                placeholder="Saisissez le fichier desktop au format JPEG, GIF, PNG" />
                        </div>
                        <div class="form-group col-6">
                            <label class="form-label required" for="display_desktop_url">Url Desktop</label>
                            <input type="url" name="display_desktop_url" id="display_desktop_url" class="form-control"
                                placeholder="Saisissez l'url de redirection pour le desktop" />
                        </div>
                    </div>

                    <div class="row">
                        <div class="form-group col-6">
                            <label class="form-label required" for="display_mobile_file">Fichier Mobile</label>
                            <input type="url" name="display_mobile_file" id="display_mobile_file" class="form-control"
                                placeholder="Saisissez le fichier mobile au format JPEG, GIF, PNG" />
                        </div>

                        <div class="form-group col-6">
                            <label class="form-label required" for="display_mobile_url">Url Mobile</label>
                            <input type="url" name="display_mobile_url" id="display_mobile_url" class="form-control"
                                placeholder="Saisissez l'url de redirection pour le mobile" />
                        </div>
                    </div>

                    <div class="row">
                        <div class="form-group col-6">
                            <label class="form-label required" for="display_tablet_file">Fichier Tablette</label>
                            <input type="url" name="display_tablet_file" id="display_tablet_file" class="form-control"
                                placeholder="Saisissez le fichier tablette au format JPEG, GIF, PNG" />
                        </div>
                        <div class="form-group col-6">
                            <label class="form-label required" for="display_tablet_url">Url Tablette</label>
                            <input type="url" name="display_tablet_url" id="display_tablet_url" class="form-control"
                                placeholder="Saisissez l'url de redirection pour la tablette" />
                        </div>
                    </div>


                </fieldset>

                <fieldset id="creativeVideo">
                    <legend>VIDEO</legend>
                    <div class="row">
                        <div class="form-group col-6">
                            <label class="form-label required" for="video_file">Fichier Vidéo</label>
                            <input type="url" name="video_file" id="video_file" class="form-control"
                                placeholder="Saisissez l'url du fichier au format MP4" />
                        </div>

                        <div class="form-group col-6">
                            <label class="form-label required" for="video_url">Url Vidéo</label>
                            <input type="url" name="video_url" id="video_url" class="form-control"
                                placeholder="Saisissez l'url de redirection" />
                        </div>
                    </div>
                </fieldset>

            </div>
            <div class="card-footer">
                <input type="submit" name="submit" class="btn btn-primary mr-2 btn-submit"
                    value="Créer une nouvelle insertion" />
            </div>

        </form>
    </div>

</div>

</div>
<!-- [ Main Content ] end -->
</div>
</div>

<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KT6H7LH" height="0" width="0"
        style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

<script src="/assets/js/vendor-all.min.js"></script>
<script src="/assets/js/plugins/bootstrap.min.js"></script>
<script src="/assets/js/plugins/feather.min.js"></script>
<script src="/assets/js/pcoded.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js"
    integrity="sha384-GNFwBvfVxBkLMJpYMOABq3c+d3KnQxudP/mGPkzpZSTYykLBNsZEnG2D9G/X/+7D" crossorigin="anonymous" async>
</script>


<!-- custom-chart js
<script src="/assets/js/pages/dashboard-sale.js"></script>  -->
<script src="https://cdn.datatables.net/1.10.24/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.10.24/js/dataTables.bootstrap5.min.js"></script>

<script src="/manager/js/manager.js"></script>


<script>
    $(document).ready(function () {
        let select_advertiser = $("#advertiser_id");
        let select_campaign = $("#campaign_id");
        let select_format = $("#format_group_id")
        let select_creativeType = $("#creative_type_id")



        $("#creativeImage").hide();
        $("#creativeVideo").hide();



        select_advertiser.on("change", function () {
            //model($(this).val());
            var advertiser_id = $(this).val()

            console.log(advertiser_id)
            $.get(`https://reporting.antennesb.fr/app/json/campaign/${advertiser_id}`, function (campagnes) {


                let list_campaign =
                    `<option value="" selected disabled>Sélectionner une campagne</option>`;
                //pour chaque éléments crée un option dans le select
                campagnes.forEach((campaign) => {
                    list_campaign +=
                        `<option value="${campaign.campaign_id}">${campaign.campaign_name}</option>`
                });

                //on affiche sur la page l'ensemble des données
                $("#campaign_id").html(list_campaign);



            })

        })


        select_format.on("change", function () {
            //model($(this).val());
            var format_group_id = $(this).val()

            console.log(format_group_id)
            $.get(`https://reporting.antennesb.fr/app/json/creative/${format_group_id}`, function (
                creativeType) {



                let list_creative =
                    `<option value="" selected disabled>Sélectionner un type créative</option>`;
                //pour chaque éléments crée un option dans le select
                creativeType.forEach((creativeType) => {
                    list_creative +=
                        `<option value="${creativeType.creative_type_id}">${creativeType.creatives_type.creative_type_name}</option>`
                });

                //on affiche sur la page l'ensemble des données
                $("#creative_type_id").html(list_creative);




            })

        })



        select_creativeType.on("change", function () {
            var creativeType_id = $(this).val()

            console.log(creativeType_id)

            if (creativeType_id === '1') {
                $('#creativeImage').show();
            } else {
                $("#creativeImage").hide();

            }

            if (creativeType_id === '2') {
                $('#creativeVideo').show();

            } else {
                $("#creativeVideo").hide();

            }


        })


        const now = new Date();

        var timestamp_now = now.setDate(now.getDate() + 1);
        var timestamp_end = now.setDate(now.getDate() + 15);

        const date_start_last = new Date(timestamp_now)
        const date_end_last = new Date(timestamp_end)


        document.getElementById("date_start").valueAsDate = date_start_last;
        document.getElementById("date_end").valueAsDate = date_end_last;

    })
</script>
</body>

</html>